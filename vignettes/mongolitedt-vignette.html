<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="D Cooley" />

<meta name="date" content="2016-06-11" />

<title>Mongolitedt Vignette</title>






<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Mongolitedt Vignette</h1>
<h4 class="author"><em>D Cooley</em></h4>
<h4 class="date"><em>2016-06-11</em></h4>



<div id="mongolitedt" class="section level2">
<h2>Mongolitedt</h2>
<p>Mongolitedt is an extension to <a href="https://cran.r-project.org/package=mongolite">mongolite</a>. It binds two methods, <code>finddt()</code> and <code>aggregatedt()</code> to the <code>mongo</code> object that’s created through <code>mongo &lt;- mongo()</code>.</p>
<p>These functions return <code>data.table</code> objects from the find or aggregate query. Therefore, the query you send to <code>mongodb</code> has to be able to be coerced into a <code>data.table</code>. If not, it will throw an error.</p>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>You bind the two functions using <code>bind_mongolitedt()</code></p>
<pre><code>## create a mongo() connection object
mongo &lt;- mongo(collection = &quot;vignette&quot;,
               db = &quot;mongolitedt&quot;,
               url = &quot;mongodb://localhost&quot;)

## looking at the mongo object we see all the methods currently attached.
mongo
# &lt;Mongo collection&gt; 'test' 
#  $aggregate(pipeline = &quot;{}&quot;, handler = NULL, pagesize = 1000) 
#  $count(query = &quot;{}&quot;) 
#  $distinct(key, query = &quot;{}&quot;) 
#  $drop() 
#  $export(con = stdout(), bson = FALSE) 
#  $find(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0, handler = NULL, pagesize = 1000) 
#  $import(con, bson = FALSE) 
#  $index(add = NULL, remove = NULL) 
#  $info() 
#  $insert(data, pagesize = 1000) 
#  $iterate(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0) 
#  $mapreduce(map, reduce, query = &quot;{}&quot;, sort = &quot;{}&quot;, limit = 0, out = NULL, scope = NULL) 
#  $remove(query, multiple = FALSE) 
#  $rename(name, db = NULL) 
#  $update(query, update = &quot;{\&quot;$set\&quot;:{}}&quot;, upsert = FALSE, multiple = FALSE) 
</code></pre>
<p>We can now bind the two new functions and see them added to the <code>mongo</code> object</p>
<pre><code>bind_mongolitedt(mongo)

## and look at the methods
mongo
# &lt;Mongo collection&gt; 'test' 
#  $aggregate(pipeline = &quot;{}&quot;, handler = NULL, pagesize = 1000) 
#  $aggregatedt(pipeline = &quot;{}&quot;, pagesize = 1000) 
#  $count(query = &quot;{}&quot;) 
#  $distinct(key, query = &quot;{}&quot;) 
#  $drop() 
#  $export(con = stdout(), bson = FALSE) 
#  $find(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0, handler = NULL, pagesize = 1000) 
#  $finddt(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0, pagesize = 1000) 
#  $import(con, bson = FALSE) 
#  $index(add = NULL, remove = NULL) 
#  $info() 
#  $insert(data, pagesize = 1000) 
#  $iterate(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0) 
#  $mapreduce(map, reduce, query = &quot;{}&quot;, sort = &quot;{}&quot;, limit = 0, out = NULL, scope = NULL) 
#  $remove(query, multiple = FALSE) 
#  $rename(name, db = NULL) 
#  $update(query, update = &quot;{\&quot;$set\&quot;:{}}&quot;, upsert = FALSE, multiple = FALSE) 
</code></pre>
<p>In the above example we see the two methods, <code>finddt()</code> and <code>aggregatedt()</code> have been attached to the <code>mongo</code> object.</p>
<p>You then use them as you would the regular <code>find</code> and <code>aggregate</code> methods. However, the returned objects will be <code>data.table</code>s.</p>
<pre><code>
data(&quot;mtcars&quot;)
mongo$insert(mtcars)
# Complete! Processed total of 32 rows.
# [1] TRUE
rm(mtcars)

df &lt;- mongo$find()
str(df)
# 'data.frame': 32 obs. of  11 variables:
#  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#  $ cyl : int  6 6 4 6 8 6 8 4 4 6 ...
#  $ disp: num  160 160 108 258 360 ...
#  $ hp  : int  110 110 93 110 175 105 245 62 95 123 ...
#  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
#  $ qsec: num  16.5 17 18.6 19.4 17 ...
#  $ vs  : int  0 0 1 1 0 1 0 1 1 1 ...
#  $ am  : int  1 1 1 0 0 0 0 0 0 0 ...
#  $ gear: int  4 4 4 3 3 3 3 4 4 4 ...
#  $ carb: int  4 4 1 1 2 1 4 2 2 4 ...

dt &lt;- mongo$finddt()
str(dt)
# Classes ‘data.table’ and 'data.frame':    32 obs. of  12 variables:
#  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#  $ cyl : int  6 6 4 6 8 6 8 4 4 6 ...
#  $ disp: num  160 160 108 258 360 ...
#  $ hp  : int  110 110 93 110 175 105 245 62 95 123 ...
#  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
#  $ qsec: num  16.5 17 18.6 19.4 17 ...
#  $ vs  : int  0 0 1 1 0 1 0 1 1 1 ...
#  $ am  : int  1 1 1 0 0 0 0 0 0 0 ...
#  $ gear: int  4 4 4 3 3 3 3 4 4 4 ...
#  $ carb: int  4 4 1 1 2 1 4 2 2 4 ...
#  $ _row: chr  &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
#  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; 

mongo$find(query = '{ &quot;mpg&quot; : 21 }')
#  Imported 2 records. Simplifying into dataframe...
#               mpg cyl disp  hp drat    wt  qsec vs am gear carb
# Mazda RX4      21   6  160 110  3.9 2.620 16.46  0  1    4    4
# Mazda RX4 Wag  21   6  160 110  3.9 2.875 17.02  0  1    4    4

mongo$finddt(query = '{ &quot;mpg&quot; : 21 }')
#  Imported 2 records.
#    mpg cyl disp  hp drat    wt  qsec vs am gear carb          _row
# 1:  21   6  160 110  3.9 2.620 16.46  0  1    4    4     Mazda RX4
# 2:  21   6  160 110  3.9 2.875 17.02  0  1    4    4 Mazda RX4 Wag

mongo$aggregate(pipeline = '[ { &quot;$match&quot; : { &quot;mpg&quot; : 21 }  } , 
                               { &quot;$project&quot; : { &quot;_id&quot; : 0, &quot;_row&quot; : 1, &quot;disp&quot; : 1 } }  ]')

#  Imported 2 records. Simplifying into dataframe...
#               disp
# Mazda RX4      160
# Mazda RX4 Wag  160


mongo$aggregatedt(pipeline = '[ { &quot;$match&quot; : { &quot;mpg&quot; : 21 }  } , 
                               { &quot;$project&quot; : { &quot;_id&quot; : 0, &quot;_row&quot; : 1, &quot;disp&quot; : 1 } }  ]')

#  Imported 2 records.
#    disp          _row
# 1:  160     Mazda RX4
# 2:  160 Mazda RX4 Wag

## clean up
rm(mongo); gc()
</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
